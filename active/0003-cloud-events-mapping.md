# [Cloud] Mappings for Cloud Events

We are using Cloud Events for pushing events around. This RFC is for defining how we use the different fields.

* Issue: https://github.com/drogue-iot/drogue-cloud/issues/29
* PR: https://github.com/drogue-iot/rfcs/pull/1

Also see:

* https://github.com/cloudevents/spec/blob/v1.0.1/spec.md
* https://github.com/cloudevents/spec/blob/v1.0.1/documented-extensions.md

## Motivation

In the past we didn't really think how we use the different fields of the cloud events structures. Neither did
we document this. With this document we want to clean up this situation.

## Requirements and non-goals

* Define how we use the required and optional fields.
* Define which extension attribute we want to use.
* Compare with other projects how they do it.
* This RFC is not about the actual payload, only about the metadata.

## device-to-cloud

Events sent from a device to the cloud.

This doesn't necessary mean that the device already created a cloud event, but in many cases, that that protocol
endpoint create a cloud event, from the request the device sent.

### Core attributes

| Field | Required | Description |
| ----- | -------- | --- |
| `id` | ✓ | By default a random UUID generated by the protocol endpoint. |
| `source` | ✓ | The [device id](#device-id) |
| `specversion` | ✓ | Always contains `1.0` |
| `type` | ✓ | ?? |
| `datacontenttype` | ✓ | The mime type of the payload. As provided by the device. Defaults to `application/octet-stream`. |
| `dataschema` || The schema of the payload. As provided by the device. |
| `subject` | | The channel the device published to. |
| `time` | ✓ | The time the protocol endpoint picked up the message from the device. If the device wants to send along a timestamp with sensor measurements, then that would be part of the payload. |

### Extension attributes

* Think about using tracing attributes: https://github.com/cloudevents/spec/blob/v1.0.1/extensions/distributed-tracing.md

## cloud-to-device

Messages sent by an application to the *command endpoint*, for delivery to a device.

### Core attributes

| Field | Required | Description |
| ----- | -------- | --- |
| `id` | ✓ ||
| `source` | ✓ ||
| `specversion` | ✓ | Always contains `1.0` |
| `type` | ✓ | |
| `datacontenttype` | | |
| `dataschema` ||| 
| `subject` |||
| `time` |||

### Extension attributes

* Think about using tracing attributes: https://github.com/cloudevents/spec/blob/v1.0.1/extensions/distributed-tracing.md

## Common Fields

### Device ID

The scoped ID of the device in the following format: `<application>/<device>`.

Application and device IDs must be "URL encoded" to carry special characters.

## Examples

### Default HTTP endpoint

### Default MQTT endpoint

### The Thing Network endpoint
