# [Cloud] Mappings for Cloud Events and CoAP

The [CoAP protocol](https://datatracker.ietf.org/doc/html/rfc7252) makes use of [options](https://datatracker.ietf.org/doc/html/rfc7252#section-5.4), which allow ["header-like values"](https://datatracker.ietf.org/doc/html/rfc7252#section-12.2) to be mapped to numbers ranging between 0-65535. This RFC is for defining said mapping between CoAP options and Cloud Events.

* Issue: 
* PR: 

Also see:

* https://github.com/cloudevents/spec/blob/v1.0.1/spec.md
* https://github.com/cloudevents/spec/blob/v1.0.1/documented-extensions.md
* https://datatracker.ietf.org/doc/html/rfc7252

## Motivation

Since CoAP doesn't have the concept of a "header" like in other protocols, they allow us to use "options". These options are represented by numbers ranging from 0-65536, with some options having resrved definitions in the CoAP spec. 

With this document we want to associate certain options to Cloud Event fields (usage defined by [this RFC](https://github.com/pranav-bhatt/rfcs/blob/main/active/0003-cloud-events-mapping.md)).

## Glossary

<dl>
<dt>

**Comments needed**
</dt>

<dd>

**Can be filled once the rest of the document is completed**
</dd>

<dt>CoAP Option Number Ranges</dt>
<dd>

According to [Section 12.2 in RFC7572](https://datatracker.ietf.org/doc/html/rfc7252#section-12.2)

> The IANA policy for future additions to this sub-registry is split into three tiers as follows. The range of 0..255 is reserved for options defined by the IETF (IETF Review or IESG Approval. The range of 256..2047 is reserved for commonly used options with public specifications (Specification Required). The range of 2048..64999 is for all other options including private or vendor-specific ones, which undergo a Designated Expert review to help ensure that the option semantics are defined correctly.  The option numbers between 65000 and 65535 inclusive are reserved for experiments. They are not meant for vendor-specific use of any kind and MUST NOT be used in operational deployments.
</dd>

<dt>Channel</dt>
<dd>
The channel is an indicator of the device to which *data stream* the event belongs. Depending on the protocol, this
can be set by the device, or generated by the protocol endpoint.

For example: In Eclipse Hono these would map to `telemetry` and `event`.
</dd>

<dt>UID</dt>
<dd>
The *unique ID* (UID) is an identifier, which is bound to the lifecycle of a resource (e.g. device). When a resource
with is deleted and re-created with the same name, it will still get a different UID.
</dd>

</dl>

## Requirements and non-goals

* Define the association of options to the required and optional fields in a Cloud Event.
* Compare with other projects how they do it.
* This RFC is not about the actual payload, only about the metadata.

## Attributes mapping to CoAP Option Numbers

|         Field         | Required | Option | Description |
| --------------------- | -------- | ------ | ----------- |
|    `Content-Format`   |          |   12   | Defined by [Section 5.10.3 in RFC7572](https://datatracker.ietf.org/doc/html/rfc7252#section-5.10.3). Will be used to fill the `datacontenttype` field in the Cloud Event |
| `Authorization token` |    âœ“     |  2048  | This token will be sent to the Authorization service, which will return the [device id](#device-id) upon validation, which will be used to fill the `source` field in the Cloud Event.|
|   `Type Information`  |          |  2049  | Type of Event, as provided by the device |
|     `Data Schema`     |          |  2050  | Schema of the payload |
|       `Subject`       |          |  2051  | Added as Cloud Events sent for cloud-to-device communications include this field |
|        `Time`         |          |  2052  | Added as Cloud Events sent for cloud-to-device communications include this field |